{
  "version": 3,
  "sources": ["../src/index.ts", "../src/utils/EventEmittable.ts", "../src/utils/applyMixins.ts", "../src/utils/mod.ts", "../src/BeatManager.ts", "../src/BufferReaderNode.ts", "../src/shaderchunks.ts", "../src/utils/lazyProgram.ts", "../src/Renderer.ts", "../src/utils/lerp.ts", "../src/WavenerdDeck.ts"],
  "sourcesContent": ["export { WavenerdDeck } from './WavenerdDeck';\nexport { BeatManager } from './BeatManager';\n\nimport { WavenerdDeck } from './WavenerdDeck';\nexport default WavenerdDeck;\n", "// Ref: https://github.com/andywer/typed-emitter/blob/master/index.d.ts\n\nexport type EventListener<T> = ( event: T ) => void;\n\nexport class EventEmittable<TEvents extends { [ type: string ]: any }> {\n  protected __eventListeners?: Map<keyof TEvents, EventListener<any>[]>;\n\n  public on<TType extends keyof TEvents & string>(\n    type: TType,\n    listener: EventListener<TEvents[ TType ]>\n  ): EventListener<TEvents[ TType ]> {\n    this.__eventListeners = this.__eventListeners || new Map();\n    let array = this.__eventListeners.get( type );\n    if ( !array ) {\n      array = [];\n      this.__eventListeners.set( type, array );\n    }\n\n    array.push( listener );\n\n    return listener;\n  }\n\n  public off<TType extends keyof TEvents & string>(\n    type: TType,\n    listener: EventListener<TEvents[ TType ]>\n  ): void {\n    this.__eventListeners = this.__eventListeners || new Map();\n    let array = this.__eventListeners.get( type );\n    if ( !array ) {\n      array = [];\n      this.__eventListeners.set( type, array );\n    }\n\n    const index = array.indexOf( listener );\n    if ( index !== -1 ) {\n      array.splice( index, 1 );\n    }\n  }\n\n  protected __emit<TType extends keyof TEvents>(\n    ...[ type, event ]: TEvents[ TType ] extends void ? [ TType ] : [ TType, TEvents[ TType ] ]\n  ): void {\n    this.__eventListeners = this.__eventListeners || new Map();\n    this.__eventListeners.get( type )?.forEach( ( listener ) => listener( event ) );\n  }\n}\n", "export function applyMixins( derivedCtor: any, baseCtors: any[] ): void {\n  baseCtors.forEach( ( baseCtor ) => {\n    Object.getOwnPropertyNames( baseCtor.prototype ).forEach( ( name ) => {\n      Object.defineProperty(\n        derivedCtor.prototype,\n        name,\n        Object.getOwnPropertyDescriptor( baseCtor.prototype, name )!\n      );\n    } );\n  } );\n}\n", "export function mod( value: number, divisor: number ): number {\n  return value - Math.floor( value / divisor ) * divisor;\n}\n", "import { EventEmittable } from './utils/EventEmittable';\nimport { applyMixins } from './utils/applyMixins';\nimport { mod } from './utils/mod';\n\nexport interface BeatManagerUpdateEvent {\n  time: number;\n  bpm: number;\n  beat: number;\n  bar: number;\n  sixteenBar: number;\n}\n\nexport class BeatManager {\n  public static CalcBeatSeconds( bpm: number ): number {\n    return 60.0 / bpm;\n  }\n\n  public static CalcBarSeconds( bpm: number ): number {\n    // return this.beatLength * 4.0;\n    return 240.0 / bpm;\n  }\n\n  public static CalcSixteenBarSeconds( bpm: number ): number {\n    // return this.barLength * 16.0;\n    return 3840.0 / bpm;\n  }\n\n  public __bpm = 140.0;\n  public get bpm(): number {\n    return this.__bpm;\n  }\n  public set bpm( value: number ) {\n    const prevBpm = this.__bpm;\n    this.__bpm = Math.max( 0.0, value );\n    this.__sixteenBar = this.__sixteenBar * prevBpm / this.__bpm;\n    this.__emit( 'changeBPM', { bpm: this.__bpm } );\n  }\n\n  public get beatSeconds(): number {\n    return BeatManager.CalcBeatSeconds( this.__bpm );\n  }\n\n  public get barSeconds(): number {\n    return BeatManager.CalcBarSeconds( this.__bpm );\n  }\n\n  public get sixteenBarSeconds(): number {\n    return BeatManager.CalcSixteenBarSeconds( this.__bpm );\n  }\n\n  private __time = 0.0;\n  public get time(): number {\n    return this.__time;\n  }\n\n  private __beat = 0.0;\n  public get beat(): number {\n    return this.__beat;\n  }\n\n  private __bar = 0.0;\n  public get bar(): number {\n    return this.__bar;\n  }\n\n  private __sixteenBar = 0.0;\n  public get sixteenBar(): number {\n    return this.__sixteenBar;\n  }\n\n  public reset(): void {\n    this.__time = 0.0;\n    this.__sixteenBar = 0.0;\n  }\n\n  public update( time: number ): BeatManagerUpdateEvent {\n    const beatSeconds = BeatManager.CalcBeatSeconds( this.__bpm );\n    const barSeconds = BeatManager.CalcBarSeconds( this.__bpm );\n    const sixteenBarSeconds = BeatManager.CalcSixteenBarSeconds( this.__bpm );\n\n    const delta = time - this.__time;\n\n    this.__sixteenBar = mod( this.__sixteenBar + delta, sixteenBarSeconds );\n    this.__bar = mod( this.__sixteenBar, barSeconds );\n    this.__beat = mod( this.__bar, beatSeconds );\n\n    this.__time = time;\n\n    const event = {\n      time,\n      bpm: this.__bpm,\n      beat: this.__beat,\n      bar: this.__bar,\n      sixteenBar: this.__sixteenBar,\n    };\n\n    this.__emit( 'update', event );\n\n    return event;\n  }\n}\n\nexport interface BeatManager extends EventEmittable<{\n  update: BeatManagerUpdateEvent;\n  changeBPM: { bpm: number };\n}> {}\napplyMixins( BeatManager, [ EventEmittable ] );\n", "import processorCode from './BufferReaderProcessor.worklet.js';\n\nconst BLOCK_SIZE = 128;\nconst CHANNELS = 2;\nconst BUFFER_SIZE_PER_CHANNEL = 65536;\n\nconst processorBlob = new Blob( [ processorCode ], { type: 'text/javascript' } );\nconst processorUrl = URL.createObjectURL( processorBlob );\n\nexport class BufferReaderNode extends AudioWorkletNode {\n  private __readBlocks: number;\n\n  public get readBlocks(): number {\n    return this.__readBlocks;\n  }\n\n  public static addModule( audio: AudioContext ): Promise<void> {\n    return audio.audioWorklet.addModule( processorUrl );\n  }\n\n  public constructor( audio: AudioContext ) {\n    super( audio, 'buffer-reader-processor', {\n      numberOfInputs: 0,\n      numberOfOutputs: 1,\n      outputChannelCount: [ CHANNELS ],\n    } );\n\n    this.__readBlocks = 0;\n\n    this.port.onmessage = ( ( { data } ) => {\n      this.__readBlocks = data;\n    } );\n  }\n\n  public write( channel: number, block: number, offset: number, buffer: ArrayLike<number> ): void {\n    const totalOffset = (\n      BUFFER_SIZE_PER_CHANNEL * channel\n      + ( BLOCK_SIZE * block ) % BUFFER_SIZE_PER_CHANNEL\n      + offset\n    );\n    this.port.postMessage( [ buffer, totalOffset ] );\n  }\n}\n", "export const shaderchunkPre = `#version 300 es\n\nprecision highp float;\n\n#define _PI 3.14159265359\n\nuniform float bpm;\nuniform vec4 timeLength;\nuniform float sampleRate;\nuniform float _deltaSample;\nuniform vec4 _timeHead;\n\nin float off;\n\nout float outL;\nout float outR;\n\nfloat paramFetch( vec4 param ) {\n  return mix( param.x, param.y, exp( -param.z * off * _deltaSample ) );\n}\n\nvec2 sampleNearest( sampler2D s, vec4 meta, float time ) {\n  if ( meta.w < time ) { return vec2( 0.0 ); }\n  float x = time / meta.x * meta.z;\n  vec2 uv = fract( vec2(\n    x,\n    floor( x ) / meta.y\n  ) ) + 0.5 / meta.xy;\n  return texture( s, uv ).xy;\n}\n\n// I have 0% confidence that the algorithm is perfect\nvec2 sampleSinc( sampler2D s, vec4 meta, float time ) {\n  if ( meta.w < time ) { return vec2( 0.0 ); }\n  vec2 sum = vec2( 0.0 );\n  float def = 0.5 - fract( time * meta.z );\n  for ( int i = -5; i <= 5; i ++ ) {\n    float x = floor( time * meta.z + float( i ) ) / meta.x;\n    float deft = def + float( i );\n    vec2 uv = fract( vec2(\n      x,\n      floor( x ) / meta.y\n    ) ) + 0.5 / meta.xy;\n    sum += texture( s, uv ).xy * min( sin( deft * _PI ) / deft / _PI, 1.0 );\n  }\n  return sum;\n}\n`;\n\nexport const shaderchunkPreLines = shaderchunkPre.split( '\\n' ).length;\n\nexport const shaderchunkPost = `void main() {\n  vec2 out2 = mainAudio( mod( _timeHead + off * _deltaSample, timeLength ) );\n  outL = out2.x;\n  outR = out2.y;\n}`;\n", "export function lazyProgram(\n  gl: WebGL2RenderingContext,\n  vert: string,\n  frag: string,\n  options: {\n    /**\n     * `KHR_parallel_shader_compile`.\n     * Compile async if provided.\n     */\n    extParallel?: any,\n\n    tfVaryings?: string[],\n\n    /**\n     * `gl.SEPARATE_ATTRIBS` by default\n     */\n    tfBufferMode?: number,\n  } = {},\n): Promise<WebGLProgram> {\n  const { extParallel, tfVaryings, tfBufferMode } = options;\n\n  let vertexShader: WebGLShader | null = null;\n  let fragmentShader: WebGLShader | null = null;\n  let program: WebGLProgram | null = null;\n\n  try {\n    // == vert =====================================================================================\n    vertexShader = gl.createShader( gl.VERTEX_SHADER )!;\n\n    gl.shaderSource( vertexShader, vert );\n    gl.compileShader( vertexShader );\n\n    if ( !gl.getShaderParameter( vertexShader, gl.COMPILE_STATUS ) ) {\n      throw new Error( gl.getShaderInfoLog( vertexShader ) ?? undefined );\n    }\n\n    // == frag =====================================================================================\n    fragmentShader = gl.createShader( gl.FRAGMENT_SHADER )!;\n\n    gl.shaderSource( fragmentShader, frag );\n    gl.compileShader( fragmentShader );\n\n    if ( !gl.getShaderParameter( fragmentShader, gl.COMPILE_STATUS ) ) {\n      throw new Error( gl.getShaderInfoLog( fragmentShader ) ?? undefined );\n    }\n\n    // == program ==================================================================================\n    program = gl.createProgram()!;\n\n    gl.attachShader( program, vertexShader );\n    gl.attachShader( program, fragmentShader );\n\n    if ( tfVaryings ) {\n      gl.transformFeedbackVaryings(\n        program,\n        tfVaryings,\n        tfBufferMode ?? gl.SEPARATE_ATTRIBS,\n      );\n    }\n\n    gl.linkProgram( program );\n\n    return new Promise( ( resolve, reject ) => {\n      const update = () => {\n        if (\n          !extParallel ||\n          gl.getProgramParameter( program!, extParallel.COMPLETION_STATUS_KHR ) === true\n        ) {\n          if ( !gl.getProgramParameter( program!, gl.LINK_STATUS ) ) {\n            gl.deleteProgram( program );\n            reject( new Error( gl.getProgramInfoLog( program! ) ?? undefined ) );\n          } else {\n            resolve( program! );\n          }\n\n          return;\n        }\n\n        setTimeout( update, 10 );\n      };\n      update();\n    } );\n  } catch ( e ) {\n    gl.deleteProgram( program );\n\n    return Promise.reject( e );\n  } finally {\n    gl.deleteShader( fragmentShader );\n    gl.deleteShader( vertexShader );\n  }\n}\n", "import { shaderchunkPost, shaderchunkPre } from './shaderchunks';\nimport { lazyProgram } from './utils/lazyProgram';\n\nconst BLOCK_SIZE = 128;\n\nexport class Renderer {\n  public readonly gl: WebGL2RenderingContext;\n  public readonly blocksPerRender: number;\n\n  public readonly __extParallel: any;\n\n  public get framesPerRender(): number {\n    return BLOCK_SIZE * this.blocksPerRender;\n  }\n\n  private __offsetBuffer: WebGLBuffer;\n  private __tfBuffers: [ WebGLBuffer, WebGLBuffer ];\n  private __transformFeedback: WebGLTransformFeedback;\n\n  private __program: WebGLProgram | null;\n  private __programCue: WebGLProgram | null;\n\n  private __textures: Map<string, WebGLTexture>;\n\n  private __dstArrays: [ Float32Array, Float32Array ];\n\n  public constructor( gl: WebGL2RenderingContext, blocksPerRender: number ) {\n    this.blocksPerRender = blocksPerRender;\n\n    this.gl = gl;\n\n    this.__extParallel = gl.getExtension( 'KHR_parallel_shader_compile' );\n\n    this.__offsetBuffer = this.__createOffsetBuffer();\n    this.__tfBuffers = [\n      this.__createTFBuffer(),\n      this.__createTFBuffer(),\n    ];\n    this.__transformFeedback = this.__createTransformFeedback( this.__tfBuffers );\n\n    this.__dstArrays = [\n      new Float32Array( this.framesPerRender ),\n      new Float32Array( this.framesPerRender ),\n    ];\n\n    this.__program = null;\n    this.__programCue = null;\n\n    this.__textures = new Map();\n  }\n\n  /**\n   * Dispose the renderer.\n   */\n  public dispose(): void {\n    const { gl } = this;\n\n    gl.deleteBuffer( this.__offsetBuffer );\n    gl.deleteBuffer( this.__tfBuffers[ 0 ] );\n    gl.deleteBuffer( this.__tfBuffers[ 1 ] );\n\n    gl.deleteTransformFeedback( this.__transformFeedback );\n\n    gl.deleteProgram( this.__program );\n    gl.deleteProgram( this.__programCue );\n\n    this.__textures.forEach( ( texture ) => {\n      gl.deleteTexture( texture );\n    } );\n  }\n\n  /**\n   * Compile given shader code and cue the shader.\n   */\n  public async compile( code: string ): Promise<void> {\n    const { gl } = this;\n\n    const program = await lazyProgram(\n      gl,\n      shaderchunkPre + code + shaderchunkPost,\n      '#version 300 es\\nvoid main(){discard;}',\n      {\n        extParallel: this.__extParallel,\n        tfVaryings: [ 'outL', 'outR' ],\n      },\n    ).catch( ( error ) => {\n      this.__programCue = null;\n      gl.deleteProgram( this.__programCue );\n\n      throw error;\n    } );\n\n    if ( program == null ) { return; }\n\n    this.__programCue = program;\n  }\n\n  /**\n   * Apply the cue shader.\n   *\n   * It does not do nothing when cue is not set.\n   * Feel free to mash this method for no reason.\n   */\n  public applyCue(): void {\n    const { gl } = this;\n\n    if ( this.__programCue == null ) { return; }\n\n    const prevProgram = this.__program;\n    this.__program = this.__programCue;\n\n    if ( prevProgram != null ) {\n      gl.deleteProgram( prevProgram );\n    }\n    this.__programCue = null;\n  }\n\n  /**\n   * Create a texture and upload data.\n   */\n  public uploadTexture(\n    textureName: string,\n    width: number,\n    height: number,\n    source: Float32Array,\n  ): void {\n    const { gl } = this;\n\n    const texture = gl.createTexture()!;\n\n    gl.bindTexture( gl.TEXTURE_2D, texture );\n\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.RGBA32F,\n      width,\n      height,\n      0,\n      gl.RGBA,\n      gl.FLOAT,\n      source,\n    );\n\n    gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST );\n    gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST );\n\n    gl.bindTexture( gl.TEXTURE_2D, null );\n\n    this.__textures.set( textureName, texture );\n  }\n\n  /**\n   * Delete a texture entry.\n   */\n  public deleteTexture( textureName: string ): void {\n    const { gl } = this;\n\n    const texture = this.__textures.get( textureName );\n    if ( texture == null ) { return; }\n\n    gl.deleteTexture( texture );\n    this.__textures.delete( textureName );\n  }\n\n  /**\n   * Set an uniform1f to the current program.\n   */\n  public uniform1f( name: string, value: number ): void {\n    const { gl, __program: program } = this;\n    if ( program == null ) { return; }\n\n    const location = gl.getUniformLocation( program, name );\n\n    gl.useProgram( program );\n    gl.uniform1f( location, value );\n    gl.useProgram( null );\n  }\n\n  /**\n   * Set an uniform4f to the current program.\n   */\n  public uniform4f( name: string, ...value: [ number, number, number, number ] ): void {\n    const { gl, __program: program } = this;\n    if ( program == null ) { return; }\n\n    const location = gl.getUniformLocation( program, name );\n\n    gl.useProgram( program );\n    gl.uniform4f( location, ...value );\n    gl.useProgram( null );\n  }\n\n  /**\n   * Set a texture uniform to the current program.\n   */\n  public uniformTexture( name: string, textureName: string, unit: number ): void {\n    const { gl, __program: program } = this;\n    if ( program == null ) { return; }\n\n    const texture = this.__textures.get( textureName );\n    if ( texture == null ) { return; }\n\n    const location = gl.getUniformLocation( program, name );\n\n    gl.activeTexture( gl.TEXTURE0 + unit );\n    gl.bindTexture( gl.TEXTURE_2D, texture );\n\n    gl.useProgram( program );\n    gl.uniform1i( location, unit );\n    gl.useProgram( null );\n  }\n\n  /**\n   * Render and return a buffer.\n   */\n  public async render( first: number, count: number ): Promise<[ Float32Array, Float32Array ]> {\n    const { gl, __program: program } = this;\n    if ( program == null ) {\n      return this.__dstArrays;\n    }\n\n    // attrib\n    const attribLocation = gl.getAttribLocation( program, 'off' );\n\n    gl.bindBuffer( gl.ARRAY_BUFFER, this.__offsetBuffer );\n    gl.enableVertexAttribArray( attribLocation );\n    gl.vertexAttribPointer( attribLocation, 1, gl.FLOAT, false, 0, 0 );\n\n    // render\n    gl.useProgram( program );\n    gl.bindTransformFeedback( gl.TRANSFORM_FEEDBACK, this.__transformFeedback );\n    gl.enable( gl.RASTERIZER_DISCARD );\n\n    gl.beginTransformFeedback( gl.POINTS );\n    gl.drawArrays( gl.POINTS, first, count );\n    gl.endTransformFeedback();\n\n    gl.disable( gl.RASTERIZER_DISCARD );\n    gl.bindTransformFeedback( gl.TRANSFORM_FEEDBACK, null );\n    gl.useProgram( null );\n\n    // feedback\n    gl.bindBuffer( gl.ARRAY_BUFFER, this.__tfBuffers[ 0 ] );\n    gl.getBufferSubData(\n      gl.ARRAY_BUFFER,\n      0,\n      this.__dstArrays[ 0 ],\n      first,\n      count,\n    );\n    gl.bindBuffer( gl.ARRAY_BUFFER, null );\n\n    gl.bindBuffer( gl.ARRAY_BUFFER, this.__tfBuffers[ 1 ] );\n    gl.getBufferSubData(\n      gl.ARRAY_BUFFER,\n      0,\n      this.__dstArrays[ 1 ],\n      first,\n      count,\n    );\n    gl.bindBuffer( gl.ARRAY_BUFFER, null );\n\n    return this.__dstArrays;\n  }\n\n  private __createOffsetBuffer(): WebGLBuffer {\n    const { gl, framesPerRender } = this;\n\n    const array = new Float32Array( framesPerRender )\n      .map( ( _, i ) => i );\n\n    const buffer = gl.createBuffer()!;\n\n    gl.bindBuffer( gl.ARRAY_BUFFER, buffer );\n    gl.bufferData( gl.ARRAY_BUFFER, array, gl.STATIC_DRAW );\n    gl.bindBuffer( gl.ARRAY_BUFFER, null );\n\n    return buffer;\n  }\n\n  private __createTFBuffer(): WebGLBuffer {\n    const { gl, framesPerRender } = this;\n\n    const buffer = gl.createBuffer()!;\n\n    gl.bindBuffer( gl.ARRAY_BUFFER, buffer );\n    gl.bufferData(\n      gl.ARRAY_BUFFER,\n      framesPerRender * Float32Array.BYTES_PER_ELEMENT,\n      gl.DYNAMIC_COPY,\n    );\n    gl.bindBuffer( gl.ARRAY_BUFFER, null );\n\n    return buffer;\n  }\n\n  private __createTransformFeedback(\n    tfBuffers: [ WebGLBuffer, WebGLBuffer ]\n  ): WebGLTransformFeedback {\n    const { gl } = this;\n\n    const tf = gl.createTransformFeedback()!;\n\n    gl.bindTransformFeedback( gl.TRANSFORM_FEEDBACK, tf );\n    gl.bindBufferBase( gl.TRANSFORM_FEEDBACK_BUFFER, 0, tfBuffers[ 0 ] );\n    gl.bindBufferBase( gl.TRANSFORM_FEEDBACK_BUFFER, 1, tfBuffers[ 1 ] );\n    gl.bindTransformFeedback( gl.TRANSFORM_FEEDBACK, null );\n\n    return tf;\n  }\n}\n", "/**\n * `lerp`, or `mix`\n */\nexport function lerp( a: number, b: number, x: number ): number {\n  return a + ( b - a ) * x;\n}\n", "import { BeatManager } from './BeatManager';\nimport { BufferReaderNode } from './BufferReaderNode';\nimport { EventEmittable } from './utils/EventEmittable';\nimport { Renderer } from './Renderer';\nimport { applyMixins } from './utils/applyMixins';\nimport { lerp } from './utils/lerp';\nimport { shaderchunkPreLines } from './shaderchunks';\n\nconst BLOCK_SIZE = 128;\n\ninterface WavenerdDeckProgram {\n  code: string;\n  requiredSamples: Set<string>;\n}\n\ninterface WavenerdDeckParamEntry {\n  name: string;\n  value: number;\n  factor: number;\n  target: number;\n}\n\ninterface WavenerdDeckSampleEntry {\n  name: string;\n  width: number;\n  height: number;\n  sampleRate: number;\n  duration: number;\n}\n\nexport class WavenerdDeck {\n  /**\n   * Its host deck.\n   * It's highly recommended to connect the node of the host deck into the node of this deck, to ensure the timing consistency.\n   */\n  public hostDeck?: WavenerdDeck;\n\n  /**\n   * The count of latency blocks.\n   * Block == 128 samples.\n   * Lower == less latency.\n   */\n  public latencyBlocks: number;\n\n  /**\n   * Its current cue status.\n   * `'none'`: There is nothing in its current cue.\n   * `'ready'`: There is a cue shader and is ready to be applied.\n   * `'applying'`: There is a cue shader and is going to be applied in the next bar.\n   */\n  private __cueStatus: 'none' | 'compiling' | 'ready' | 'applying' = 'none';\n  public get cueStatus(): 'none' | 'compiling' | 'ready' | 'applying' {\n    return this.__cueStatus;\n  }\n\n  /**\n   * Blocks per a render.\n   */\n  private __blocksPerRender: number;\n  public get blocksPerRender(): number {\n    return this.__blocksPerRender;\n  }\n\n  /**\n   * Frames per a render\n   */\n  public get framesPerRender(): number {\n    return BLOCK_SIZE * this.__blocksPerRender;\n  }\n\n  /**\n   * Its current bpm.\n   */\n  public get bpm(): number {\n    return this.beatManager.bpm;\n  }\n  public set bpm( value: number ) {\n    this.beatManager.bpm = value;\n  }\n\n  /**\n   * Its last updated time.\n   * Intended to be used for calculation of deltaTime inside (@link __prepareBuffer).\n   */\n  private __lastUpdatedTime: number;\n\n  /**\n   * Its renderer.\n   */\n  private __renderer: Renderer;\n\n  /**\n   * Its last compile error happened in [[WavenerdDeck.compile]].\n   */\n  private __lastError: any;\n  public get lastError(): any {\n    return this.__lastError;\n  }\n\n  /**\n   * Its binded `AudioContext`.\n   */\n  private __audio: AudioContext;\n  public get audio(): AudioContext {\n    return this.__audio;\n  }\n\n  /**\n   * Its node of the AudioContext.\n   */\n  private __node: GainNode;\n  public get node(): GainNode {\n    return this.__node;\n  }\n\n  private __bufferReaderNode?: BufferReaderNode;\n  private __bufferWriteBlocks: number;\n\n  /**\n   * Alias for the `audio.sampleRate` .\n   */\n  public get sampleRate(): number {\n    return this.__audio.sampleRate;\n  }\n\n  private __beatManager: BeatManager;\n  public get beatManager(): BeatManager {\n    const hostDeckBeatManager = this.hostDeck?.beatManager;\n    if ( hostDeckBeatManager ) {\n      return hostDeckBeatManager;\n    }\n\n    return this.__beatManager;\n  }\n\n  private __program: WavenerdDeckProgram | null;\n  private __programCue: WavenerdDeckProgram | null;\n  private __programSwapTime: number;\n\n  private __params = new Map<string, WavenerdDeckParamEntry>();\n  private get params(): Map<string, WavenerdDeckParamEntry> {\n    return this.__params;\n  }\n\n  private __samples = new Map<string, WavenerdDeckSampleEntry>();\n  private get samples(): Map<string, WavenerdDeckSampleEntry> {\n    if ( this.hostDeck ) {\n      return this.hostDeck.samples;\n    }\n\n    return this.__samples;\n  }\n\n  /**\n   * Constructor of the WavenerdDeck.\n   */\n  public constructor( {\n    gl,\n    audio,\n    hostDeck,\n    latencyBlocks,\n    blocksPerRender,\n    bpm,\n  }: {\n    gl: WebGL2RenderingContext;\n    audio: AudioContext;\n    hostDeck?: WavenerdDeck;\n    latencyBlocks?: number;\n    blocksPerRender?: number;\n    bpm?: number;\n  } ) {\n    this.latencyBlocks = latencyBlocks ?? 16;\n    this.__blocksPerRender = blocksPerRender ?? 16;\n\n    // -- host deck --------------------------------------------------------------------------------\n    if ( hostDeck ) {\n      this.hostDeck = hostDeck;\n    }\n\n    // -- beat manager -----------------------------------------------------------------------------\n    this.__beatManager = new BeatManager();\n    this.__beatManager.bpm = bpm ?? 140;\n    this.__beatManager.on( 'changeBPM', ( { bpm } ) => {\n      this.__emit( 'changeBPM', { bpm } );\n    } );\n\n    this.__lastUpdatedTime = 0.0;\n\n    // -- renderer ---------------------------------------------------------------------------------\n    this.__renderer = new Renderer( gl, this.blocksPerRender );\n\n    this.__program = null;\n    this.__programCue = null;\n    this.__programSwapTime = 0.0;\n\n    // -- audio ------------------------------------------------------------------------------------\n    this.__audio = audio;\n    this.__node = audio.createGain();\n\n    BufferReaderNode.addModule( audio ).then( () => {\n      this.__bufferReaderNode = new BufferReaderNode( audio );\n      this.__bufferReaderNode.connect( this.__node );\n    } );\n\n    this.__bufferWriteBlocks = 0;\n  }\n\n  /**\n   * Dispose this WavenerdDeck.\n   */\n  public dispose(): void {\n    this.__setCueStatus( 'none' );\n\n    this.__renderer.dispose();\n\n    this.__bufferReaderNode?.disconnect();\n  }\n\n  /**\n   * Compile given shader code and cue the shader.\n   */\n  public async compile( code: string ): Promise<void> {\n    this.__setCueStatus( 'compiling' );\n\n    await this.__renderer.compile( code ).catch( ( e ) => {\n      const error = this.__processErrorMessage( e );\n\n      this.__programCue = null;\n\n      this.__setCueStatus( 'none' );\n\n      this.__emit( 'error', { error } );\n      this.__lastError = error;\n\n      throw new Error( error ?? undefined );\n    } );\n\n    const requiredSamples = new Set<string>();\n    for ( const name of this.samples.keys() ) {\n      if ( code.search( 'sample_' + name ) !== -1 ) {\n        requiredSamples.add( name );\n      }\n    }\n\n    this.__programCue = {\n      code,\n      requiredSamples\n    };\n\n    this.__setCueStatus( 'ready' );\n\n    this.__emit( 'error', { error: null } );\n    this.__lastError = null;\n  }\n\n  /**\n   * Apply the cue shader after the bar ends.\n   */\n  public applyCue(): void {\n    if ( this.__cueStatus === 'ready' ) {\n      this.__setCueStatus( 'applying' );\n\n      this.__programSwapTime =\n        this.beatManager.time - this.beatManager.bar + this.beatManager.barSeconds;\n    }\n  }\n\n  /**\n   * Set a uniform value.\n   */\n  public setParam( name: string, value: number, factor = 50.0 ): void {\n    const param = this.params.get( name );\n    if ( param ) {\n      param.target = value;\n      param.factor = factor;\n    } else {\n      this.params.set( name, { name, target: value, value, factor } );\n    }\n\n    this.__emit( 'setParam', { name, value, factor } );\n  }\n\n  /**\n   * Load a sample and store as a uniform texture.\n   */\n  public async loadSample( name: string, inputBuffer: ArrayBuffer ): Promise<void> {\n    const audioBuffer = await this.__audio.decodeAudioData( inputBuffer );\n\n    const { sampleRate, duration } = audioBuffer;\n    const frames = audioBuffer.length;\n    const width = 2048;\n    const lengthCeiled = Math.ceil( frames / 2048.0 );\n    const height = lengthCeiled;\n\n    const buffer = new Float32Array( width * height * 4 );\n    const channels = audioBuffer.numberOfChannels;\n\n    const dataL = audioBuffer.getChannelData( 0 );\n    const dataR = audioBuffer.getChannelData( channels === 1 ? 0 : 1 );\n\n    for ( let i = 0; i < frames; i ++ ) {\n      buffer[ i * 4 + 0 ] = dataL[ i ];\n      buffer[ i * 4 + 1 ] = dataR[ i ];\n    }\n\n    this.__renderer.uploadTexture( name, width, height, buffer );\n\n    this.samples.set(\n      name,\n      {\n        name,\n        width,\n        height,\n        sampleRate,\n        duration\n      }\n    );\n\n    if ( this.__program && this.__program.code.search( 'sample_' + name ) ) {\n      this.__program.requiredSamples.add( name );\n    }\n\n    if ( this.__programCue && this.__programCue.code.search( 'sample_' + name ) ) {\n      this.__programCue.requiredSamples.add( name );\n    }\n\n    this.__emit( 'loadSample', { name, duration, sampleRate } );\n  }\n\n  /**\n   * Delete a sample.\n   */\n  public deleteSample( name: string ): void {\n    if ( this.samples.has( name ) ) {\n      this.samples.delete( name );\n\n      this.__renderer.deleteTexture( name );\n\n      this.__emit( 'deleteSample', { name } );\n    }\n  }\n\n  public async update(): Promise<void> {\n    const bufferReaderNode = this.__bufferReaderNode;\n    if ( bufferReaderNode == null ) { return; }\n\n    const { readBlocks } = bufferReaderNode;\n    const { sampleRate, blocksPerRender, framesPerRender } = this;\n\n    const blockAhead = this.__bufferWriteBlocks - readBlocks;\n\n    // we don't have to render this time\n    if ( blockAhead > this.latencyBlocks ) {\n      return;\n    }\n\n    // we're very behind\n    if ( blockAhead < 0 ) {\n      this.__bufferWriteBlocks = (\n        Math.floor( readBlocks / blocksPerRender ) + 1\n      ) * blocksPerRender;\n    }\n\n    const genTime = BLOCK_SIZE * this.__bufferWriteBlocks / sampleRate;\n    this.beatManager.update( genTime );\n\n    // should I process the next program?\n    let beginNext = this.__cueStatus === 'applying'\n      ? Math.floor( ( this.__programSwapTime - genTime ) * sampleRate )\n      : Infinity;\n    beginNext = Math.min( beginNext, framesPerRender );\n\n    if ( beginNext < 0 ) {\n      this.__setCueStatus( 'none' );\n\n      this.__renderer.applyCue();\n\n      this.__program = this.__programCue;\n      this.__programCue = null;\n\n      beginNext = framesPerRender;\n    }\n\n    if ( this.__program ) {\n      await this.__prepareBuffer( 0, beginNext );\n    }\n\n    // process the next program??\n    if ( beginNext < framesPerRender && this.__programCue != null ) {\n      this.__setCueStatus( 'none' );\n\n      this.__renderer.applyCue();\n\n      this.__program = this.__programCue;\n      this.__programCue = null;\n\n      await this.__prepareBuffer( beginNext, framesPerRender - beginNext );\n    }\n\n    this.__bufferWriteBlocks += this.blocksPerRender;\n\n    // emit an event\n    this.__emit( 'update' );\n  }\n\n  private async __prepareBuffer(\n    first: number,\n    count: number\n  ): Promise<void> {\n    const bufferReaderNode = this.__bufferReaderNode;\n    if ( bufferReaderNode == null ) { return; }\n\n    const {\n      time,\n      beatSeconds,\n      barSeconds,\n      sixteenBarSeconds,\n      beat,\n      bar,\n      sixteenBar,\n    } = this.beatManager;\n    const { sampleRate } = this;\n\n    const delta = time - this.__lastUpdatedTime;\n    this.__lastUpdatedTime = time;\n\n    // render\n    this.params.forEach( ( param ) => {\n      if ( param.factor <= 0.0 ) {\n        param.value = param.target;\n      } else {\n        param.value = lerp( param.target, param.value, Math.exp( -param.factor * delta ) );\n      }\n\n      this.__renderer.uniform4f(\n        'param_' + param.name,\n        param.target,\n        param.value,\n        param.factor,\n        0.0\n      );\n    } );\n\n    let textureUnit = 0;\n    this.samples.forEach( ( sample ) => {\n      this.__renderer.uniformTexture( 'sample_' + sample.name, sample.name, textureUnit );\n      textureUnit ++;\n\n      this.__renderer.uniform4f(\n        'sample_' + sample.name + '_meta',\n        sample.width,\n        sample.height,\n        sample.sampleRate,\n        sample.duration\n      );\n    } );\n\n    this.__renderer.uniform1f( 'bpm', this.bpm );\n    this.__renderer.uniform1f( '_deltaSample', 1.0 / sampleRate );\n    this.__renderer.uniform4f(\n      'timeLength',\n      beatSeconds,\n      barSeconds,\n      sixteenBarSeconds,\n      1E16\n    );\n    this.__renderer.uniform4f(\n      '_timeHead',\n      beat,\n      bar,\n      sixteenBar,\n      time\n    );\n\n    const [ outL, outR ] = await this.__renderer.render( first, count );\n\n    bufferReaderNode.write(\n      0,\n      this.__bufferWriteBlocks,\n      first,\n      outL.subarray( first, first + count ),\n    );\n\n    bufferReaderNode.write(\n      1,\n      this.__bufferWriteBlocks,\n      first,\n      outR.subarray( first, first + count ),\n    );\n  }\n\n  private __setCueStatus( cueStatus: 'none' | 'compiling' | 'ready' | 'applying' ): void {\n    this.__cueStatus = cueStatus;\n    this.__emit( 'changeCueStatus', { cueStatus } );\n  }\n\n  private __processErrorMessage( error: any ): string | null {\n    const str: string | undefined = error?.message ?? error;\n    if ( !str ) { return null; }\n\n    return str.replace( /ERROR: (\\d+):(\\d+)/g, ( match, ...args ) => {\n      const line = parseInt( args[ 1 ] ) - shaderchunkPreLines + 1;\n      return `ERROR: ${ args[ 0 ] }:${ line }`;\n    } );\n  }\n}\n\nexport interface WavenerdDeck extends EventEmittable<{\n  update: void;\n  changeCueStatus: { cueStatus: 'none' | 'compiling' | 'ready' | 'applying' };\n  loadSample: { name: string; sampleRate: number; duration: number };\n  setParam: { name: string; value: number; factor: number };\n  deleteSample: { name: string };\n  changeBPM: { bpm: number };\n  error: { error: string | null };\n}> {}\napplyMixins( WavenerdDeck, [ EventEmittable ] );\n"],
  "mappings": "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",
  "names": []
}
